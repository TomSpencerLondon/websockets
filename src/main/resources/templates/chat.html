<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Chat</title>
    <script th:src="@{/webjars/sockjs-client/1.5.1/sockjs.min.js}"></script>
    <script th:src="@{/webjars/stomp-websocket/2.3.3/stomp.min.js}"></script>
    <link href="/css/output.css" rel="stylesheet">
</head>
<body class="bg-gray-100 font-sans text-gray-800">

<div class="flex justify-center items-center h-screen">
    <!-- Chat Window Container -->
    <div class="chat-window">
        <!-- Chat Header -->
        <div class="chat-header">WebSocket Chat</div>

        <!-- Message List -->
        <div class="message-list">
            <ul id="message-list" class="space-y-2">
                <li th:each="message : ${messages}" class="message-item">
                    <span th:text="${message.sender}" class="message-sender">Sender</span>
                    <span th:text="${message.content}" class="message-content">Message</span>
                </li>
            </ul>
        </div>

        <!-- Input Area -->
        <div class="input-area">
            <input type="text" id="message-input" placeholder="Type your message..." class="input-field" />
            <button id="send-button" class="send-button">Send</button>
        </div>
    </div>
</div>

<script>
    let stompClient = null;

    // Connect to the WebSocket server
    function connect() {
        const socket = new SockJS('/chat'); // Connect to the "/chat" endpoint
        stompClient = Stomp.over(socket);

        // Connect to the STOMP server
        stompClient.connect({}, function () {
            // Subscribe to the "/topic/messages" endpoint
            stompClient.subscribe('/topic/messages', function (messageOutput) {
                showMessage(JSON.parse(messageOutput.body));
            });
        });
    }

    // Send a message
    function sendMessage() {
        const inputElement = document.getElementById('message-input');
        const content = inputElement.value.trim();

        if (content) { // Send message only if input is not empty
            stompClient.send("/app/sendMessage", {}, JSON.stringify({'sender': 'User', 'content': content}));
            inputElement.value = ''; // Clear the input field
        }
    }

    // Display a message in the chat window
    function showMessage(message) {
        const messageList = document.getElementById('message-list');

        // Create a new <li> element
        const messageElement = document.createElement('li');
        messageElement.classList.add('message-item', 'flex', 'items-center', 'space-x-2'); // Add custom classes for styling

        // Create a <span> for the sender
        const senderElement = document.createElement('span');
        senderElement.classList.add('message-sender', 'font-semibold', 'text-blue-500'); // Add Tailwind classes for styling
        senderElement.textContent = message.sender;  // Set the sender's name

        // Create a <span> for the message content
        const contentElement = document.createElement('span');
        contentElement.classList.add('message-content', 'text-gray-800');  // Add Tailwind classes for styling
        contentElement.textContent = message.content;  // Set the message content

        // Append the sender and content spans to the <li> element
        messageElement.appendChild(senderElement);
        messageElement.appendChild(contentElement);

        // Append the <li> to the message list
        messageList.appendChild(messageElement);
    }

    // Set up event listeners
    document.getElementById('send-button').addEventListener('click', sendMessage);
    document.getElementById('message-input').addEventListener('keyup', function(event) {
        if (event.key === 'Enter') { // Send message on Enter key
            sendMessage();
        }
    });

    // Connect when the page loads
    connect();
</script>

</body>
</html>
